<!DOCTYPE html>
<html>
<head>

    <meta charset=utf-8 />
    <title>复制事件</title>
</head>
<body>
<!-- 可以将可编辑div透明度设置为0 或者将其left设置成-2000 哈哈 -->
<div id="divTest" contenteditable='true' style="opacity: 0;">可编辑div</div>
</body>
<script type="text/javascript" src="../jquery-2.0.3.js"></script>

<script>
    /*
         复制图片   http://codebits.glennjones.net/copypaste/pasteimagedata.htm
         另一种实现 不支持ie  暂时发现非chrome是使用 $('[contenteditable]') div#upload-global-FF-paste-box  跟我想的一样 --  http://imgur.com/gallery
         对于document.body 顺序是先paste 再 默认的input事件 
         chrome:可以复制qq截图  就是因为他支持 e.clipboardData.items
     */
    document.body.onpaste = function(e) {
           if(e.clipboardData.items){  //chrome
                var items = e.clipboardData.items;   //TODO  clipboardData 只有在document.body上有  items目前只支持chrome
                for (var i = 0; i < items.length; ++i) {
                    var item = e.clipboardData.items[i];
                    if (items[i].kind == 'file') {
                        var fileReader = new FileReader();
                        fileReader.onloadend = function () {
                            var d = this.result.substr( this.result.indexOf(',')+1);
                            var img = document.createElement("img");
                            img.src= "data:image/jpeg;base64,"+d;
                            document.body.appendChild(img);
                        };
                        fileReader.readAsDataURL(item.getAsFile());
                        break;
                    }
                }
           }else{
                $('#divTest').focus();
                setTimeout(function(){
                    var img=$('#divTest').find('img');
                    img=img.length?img[0].src:'';
                    $('#divTest').html('');
                    //use img'src do sometings
                },800);
           }
    };
</script>
</html>
