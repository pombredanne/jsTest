<!doctype html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Canvas Drag and Drop Test</title>
</head>
<body>
	<section>
		<div>
			<canvas id="canvas" width="400" height="300">
				This text is displayed if your browser does not support HTML5 Canvas.
			</canvas>
		</div>
	</section>
	<script type="text/javascript">

		var canvas,
			ctx,
			x = 75,
			y = 50,
			WIDTH = 400,
			HEIGHT = 300,
			dragok = false;

		var drag={
			rect:function(x,y,w,h){
				ctx.beginPath();
				ctx.rect(x,y,w,h);
				ctx.closePath();
				ctx.fill();	
			},
			clear:function(){
				 ctx.clearRect(0, 0, WIDTH, HEIGHT);
			},
			init:function(){
				canvas = document.getElementById("canvas");
				ctx = canvas.getContext("2d");

				return setInterval(function(){   //拖动的重点 其实就是 将当前图像清空 重新绘制
					drag.draw();
				}, 10);	
			},
			draw:function(){
				this.clear();	
				ctx.fillStyle = "#FAF7F8";
				this.rect(0,0,WIDTH,HEIGHT);
				ctx.fillStyle = "#444444";
				this.rect(x - 15, y - 15, 30, 30);
			}	
		}

		drag.init();
		canvas.onmousedown = function(e){
			if (e.pageX < x + 15 + canvas.offsetLeft && e.pageX > x - 15 +canvas.offsetLeft && e.pageY < y + 15 + canvas.offsetTop &&
			 e.pageY > y -15 + canvas.offsetTop){
			  x = e.pageX - canvas.offsetLeft;
			  y = e.pageY - canvas.offsetTop;
			  dragok = true;
			  
			  canvas.onmousemove = function(event){
			  	if (dragok){
			  		// TODO 注意这里 对其指定的x,y坐标 是相对与 canvas的
					x = event.pageX - canvas.offsetLeft;
					y = event.pageY - canvas.offsetTop;
				}
			  };

			 }
		};
		canvas.onmouseup = function(){
			dragok = false;
		 	canvas.onmousemove = null;
		};

	</script>

</body>
</html>
﻿