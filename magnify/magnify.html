
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>无标题文档</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script type="text/javascript">
//        $(document).ready(function(){
//            $('.small,.boxbig img').load(function(){  //这种方法不适用于ie
                   // code
//             });
//        });

        $(window).load(function(){
            var mouseX,		//鼠标移动的位置X
                    mouseY,		//鼠标移动的位置Y
                    markLeft,	//放大镜移动的左部距离
                    markTop,	//放大镜移动的顶部距离
                    perX,	//移动的X百分比
                    perY,	//移动的Y百分比
                    bigLeft ,	//大图要移动left的距离
                    bigTop,	//大图要移动top的距离
                    ELELEFT=$('.small').offset().left,
                    ELETOP=$('.small').offset().top,
                    MARKHIG=$('.mark').outerHeight(),
                    MARKWID=$('.mark').outerWidth(),
                    SMALLHIG=$('.small').height(),
                    SMALLWID=$('.small').width(),
                    BIGHIG=$('.big').outerHeight(),
                    BIGWID=$('.big').outerWidth(),
                    MAXLEFT = SMALLWID-MARKWID,
                    MAXTOP =SMALLHIG -MARKHIG;


            //鼠标小图上移动时
            function imgMouseMove(event){
                //console.log(this)   //使用(1),(2)方法 此处this为当前dom元素 使用(2)方法 此处this指向window
                var $mark = $(this).find(".mark");

                //鼠标在小图的位置
                markLeft = event.pageX-ELELEFT - MARKWID/2;
                markTop = event.pageY-ELETOP - MARKHIG/2;

                //通过判断，让小框只能在小图区域中移动
                if(markLeft<0){
                    markLeft = 0;
                }else if(markLeft>MAXLEFT){
                    markLeft = MAXLEFT;
                }

                if(markTop<0){
                    markTop = 0;
                }else if(markTop>MAXTOP){
                    markTop = MAXTOP;
                }

                //获取放大镜的移动比例，即这个小框在区域中移动的比例 关键思想
                perX = markLeft/SMALLWID;
                perY = markTop/SMALLHIG;
                bigLeft = -perX*BIGWID;
                bigTop = -perY*BIGHIG;

                //设定小框的位置
                $mark.css({"left":markLeft,"top":markTop});
                $(".big").css({"left":bigLeft,"top":bigTop});
            }

            //$(".small").bind("mousemove",imgMouseMove);  //  (1)  这种方法可以默认传event
//                    $('.small').bind('hover',function(event){   //   (2)  这种方法会让imgMouseMove方法在jquery函数中参与回调 因此会改变this指向
//                        $('.big').add($('.mark')).toggle();
//                    }).bind('mousemove',function(event){
//                        imgMouseMove(event);
//                    })

            $('.small').hover(function(){           //  (3)  同(1)一样
                $('.big').add($('.mark')).toggle();
            }).mousemove(imgMouseMove);
        });
    </script>
    <style type="text/css">
        *{ margin:0px; padding:0px;}

        .box{
            position:relative;
            margin:10px auto;
            padding:10px;
            border:1px solid #666;
            background:#CCC;
            width:250px;
        }

        .box .small{
            position:relative;
            text-align:center;
            background:#FFF;}

        .box .small .mark{
            position:absolute;
            top:0;
            left:0;
            z-index:2;
            width:80px;
            height:80px;
            background:#FFFFFF;
            filter:alpha(opacity:50);
            opacity:0.5;
            border:1px solid #333;
            display:none;
        }

        .box .big{
            position:absolute;
            left:225px;
            top:0;
            display:none;
        }

        .boxbig{
            position:absolute;
            left:275px;
            top:0;
            width:160px;
            height:160px;
            overflow:hidden;
        }


    </style>
</head>
<body>
<div class="box">
    <div class="small">
        <span class="mark"></span>
        <img src="http://demo.jb51.net/js/2012/mymagnifier/images/1_s.jpg" alt="" />
    </div>
    <div class="boxbig">
        <div class="big"><img src="http://demo.jb51.net/js/2012/mymagnifier/images/1_b.jpg" alt="" /></div>
    </div>
</div>
</body>
</html>
